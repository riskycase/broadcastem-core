include:
  - template: Dependency-Scanning.gitlab-ci.yml
  - template: SAST.gitlab-ci.yml
  - template: Code-Quality.gitlab-ci.yml 
  - template: License-Scanning.gitlab-ci.yml

image: node:latest

stages:
  - test
  - checks

cache:
  paths:
    - node_modules/
    
Test:
  stage: checks
  before_script:
    - yarn global add nyc
    - yarn install --frozen-lockfile
    - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
    - chmod +x ./cc-test-reporter
    - ./cc-test-reporter before-build
  script:
    - nyc --reporter=lcov yarn test
    - ./cc-test-reporter after-build --exit-code 0 
